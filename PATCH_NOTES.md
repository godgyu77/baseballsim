# 🎮 KBO 프로야구 단장 시뮬레이터 - 패치 노트

## 📅 버전: v2.0.0 (로컬 개발 버전)

**마지막 GitHub 커밋:** `82d3134` (작전지시 오류 수정)  
**현재 로컬 상태:** 커밋되지 않은 변경사항 포함

---

## 🆕 주요 신규 기능

### 1. **게임 난이도 시스템 (Difficulty System)**
- **이지 모드 (EASY)**
  - 초기 자금: **50억 원**
  - 선수단 샐러리캡: **200억 원**
  - 용병 샐러리캡: **60억 원**
  - 수입 배율: **1.2배** (모든 수입 증가)
  - 샐러리캡 초과: **가능** (초과분 2배 사치세 차감)

- **하드 모드 (HARD)**
  - 초기 자금: **20억 원**
  - 선수단 샐러리캡: **137억 원**
  - 용병 샐러리캡: **40억 원**
  - 수입 배율: **1.0배** (기본)
  - 샐러리캡 초과: **불가능** (진행 차단)

- **난이도 선택 화면**
  - 게임 시작 시 난이도 선택 모달 추가
  - 각 모드별 상세 설명 제공
  - 헤더에 난이도 뱃지 표시 (이지: 파란색, 하드: 빨간색)

### 2. **새로운 파일 추가**
- `src/components/DifficultyModal.tsx` - 난이도 선택 모달 컴포넌트
- `src/constants/GameConfig.ts` - 난이도별 게임 설정 상수

---

## 🔧 개선 사항

### 1. **게임 시작 플로우 개선**
- **이전:** [새 게임 시작] → [팀 선택 화면]
- **현재:** [새 게임 시작] → **[난이도 선택]** → [팀 선택 화면]
- 불러오기 시 난이도 정보 자동 복원

### 2. **저장/불러오기 시스템 강화**
- 난이도 정보 저장/복원 기능 추가
- 기존 저장 데이터와의 호환성 유지 (기본값: HARD)
- 게임 상태 복원 시 난이도 뱃지 자동 표시

### 3. **ChatInterface.tsx 대규모 리팩토링**
- `handleSend` 함수 TDZ(Temporal Dead Zone) 오류 수정
- 함수 선언 순서 최적화 (410줄 변경)
- 코드 가독성 및 유지보수성 향상

### 4. **GameHeader 개선**
- 난이도 뱃지 표시 기능 추가
- 모바일 반응형 레이아웃 개선 (87줄 변경)
- 터치 최적화

### 5. **StartScreen 개선**
- 모바일 터치 이벤트 중복 방지 로직 추가
- 불러오기 루프 버그 수정
- UI/UX 개선 (52줄 변경)

### 6. **TeamSelector 개선**
- 모바일 반응형 레이아웃 최적화
- 터치 이벤트 처리 개선 (20줄 변경)

### 7. **MessageBubble 개선**
- 모바일 테이블 스크롤 최적화
- 텍스트 크기 조정 (10줄 변경)

### 8. **GameConstants.ts 프롬프트 대폭 개선 (440줄 변경)**

#### **난이도 시스템 프롬프트 추가**
- 이지/하드 모드별 자금, 샐러리캡, 수입 배율 명시
- 난이도별 AI 행동 패턴 가이드 추가
  - **이지 모드**: 협상 관대함, 트레이드 유리, 성장 확률 상승
  - **하드 모드**: 협상 깐깐함, 악덕 상인 모드, 현실적 성장
- 저장/불러오기 시 난이도 정보 유지 규칙 추가

#### **방송국 계약 로직 강화**
- 1월 1주차 방송국 계약 필수 출력 규칙 추가
- 3단계 필수 출력 프로세스 정의:
  1. 방송국 계약 안내 텍스트
  2. 방송국 목록 마크다운 테이블
  3. [OPTIONS] 태그 필수 포함
- 방송국 선택 전까지 다른 구단 진행 금지 규칙

#### **외국인 선수 생성 로직 강화**
- **한국인 제외 필터링 강화**
  - 국적 필터: 'Korea', '한국', 'South Korea', '대한민국' 절대 제외
  - 이름 필터: 한국 성씨(김, 이, 박, 최, 정 등)로 시작하는 이름 제외
- **외국인 선수 이름 한국어 표시 규칙**
  - 모든 외국인 선수 이름은 한글로만 표기 (예: "마이클 존슨")
  - 영문 표기 금지, 일본인 이름도 한글 표기
- **외국인 투수 구속 데이터 생성**
  - '평균 구속(km/h)' 컬럼 필수 포함
  - 140km/h ~ 165km/h 범위 내 현실적 값 생성
- **외국인 야수 포지션 표시**
  - 포지션 컬럼을 맨 앞에 명확히 표시
  - 1루수, 2루수, 3루수, 유격수, 좌익수, 중견수, 우익수, 포수 중 하나

#### **용병 영입 시스템 개선**
- **영입 기회 보장 로직**
  - 가격대별 비율 명시: 고가형 20%, 중저가형 50%, 저가형 30%
  - 최소 3번의 협상 기회 보장
- **AI 용병 영입 로직**
  - 샐러리캡 엄수 (3명 총액 40억/60억)
  - 합리적 경쟁 (무조건적 입찰 금지)
  - 성능 우선 영입

#### **트레이드 시스템 개선**
- 난이도별 트레이드 로직 조정
  - **이지 모드**: 상호 이익(Win-Win) 트레이드 수락, 약간의 손해 감수
  - **하드 모드**: 악덕 상인 모드 유지, 철저한 이득 계산
- 역제안(Counter Offer) 로직 강화
- 프랜차이즈 스타 보호 규칙 추가

#### **기타 프롬프트 개선**
- 저장 데이터 무결성 원칙 강화
- 구단별 구단주 성향 고정 배분 추가 (A/B/C/D 유형)
- 팀 케미스트리 및 사기 시스템 설명 추가
- 연말 시상식 이벤트 규칙 추가
- 날씨 및 우천 취소 변수 추가
- 시스템 데이터 무결성 원칙 최우선 순위 명시

### 9. **전역 스타일 개선 (index.css)**
- 모바일 폰트 크기 최적화
- 터치 타겟 크기 조정 (최소 44px)
- iOS 자동 줌 방지
- 스크롤 동작 개선 (27줄 변경)

---

## 🐛 버그 수정

### 1. **치명적 오류 수정**
- ✅ `handleSend` 함수 TDZ 오류 해결
  - `Cannot access 'handleSend' before initialization` 오류 수정
  - 함수 선언 순서 재배치

### 2. **모바일 관련 버그 수정**
- ✅ 불러오기 시 무한 루프/재진행 오류 수정
- ✅ 터치 이벤트 중복 호출 방지
- ✅ 화면 레이아웃 깨짐 현상 개선

### 3. **UI 버그 수정**
- ✅ "지시사항" 버튼이 불러오기 후 사라지는 문제 해결
- ✅ 모바일에서 텍스트 겹침 현상 개선
- ✅ 테이블 가로 스크롤 개선

---

## 📊 변경 통계

### 수정된 파일 (9개)
- `src/App.tsx` - 31줄 변경
- `src/components/ChatInterface.tsx` - 410줄 변경 (대규모 리팩토링)
- `src/components/GameHeader.tsx` - 87줄 변경
- `src/components/MessageBubble.tsx` - 10줄 변경
- `src/components/StartScreen.tsx` - 52줄 변경
- `src/components/TeamSelector.tsx` - 20줄 변경
- `src/constants/GameConstants.ts` - 440줄 변경
- `src/index.css` - 27줄 변경
- `dist/index.html` - 4줄 변경

### 신규 파일 (2개)
- `src/components/DifficultyModal.tsx` - 신규 생성
- `src/constants/GameConfig.ts` - 신규 생성

**총 변경량:** +654줄 추가, -427줄 삭제

---

## 🎯 주요 개선 영역

1. **게임 밸런스**
   - 난이도 시스템으로 다양한 플레이 스타일 지원
   - 이지 모드: 편안한 경험
   - 하드 모드: 도전적인 경험

2. **모바일 최적화**
   - 터치 이벤트 처리 개선
   - 반응형 레이아웃 전면 개선
   - 폰트 크기 및 터치 타겟 최적화

3. **코드 품질**
   - TDZ 오류 수정
   - 함수 선언 순서 최적화
   - 타입 안정성 향상

4. **사용자 경험**
   - 게임 시작 플로우 개선
   - 저장/불러오기 안정성 향상
   - UI/UX 전반적 개선

---

## 📝 참고 사항

- 이 패치 노트는 로컬 개발 버전 기준입니다
- GitHub에 커밋되지 않은 변경사항이 포함되어 있습니다
- 프로덕션 배포 전 테스트가 필요합니다

---

**작성일:** 2024년  
**버전:** v2.0.0 (로컬 개발 버전)

