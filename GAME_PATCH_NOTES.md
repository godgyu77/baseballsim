# 🎮 KBO 프로야구 단장 시뮬레이터 - 게임 패치 노트

## 📅 패치 버전: v2.0.0
**릴리즈 날짜**: 2024년  
**이전 버전**: v1.0.0 (GitHub 커밋: `82d3134`)  
**현재 버전**: v2.0.0 (로컬 개발 버전)

---

## 🎯 패치 개요

이번 업데이트는 게임의 핵심 시스템을 대폭 개선한 메이저 업데이트입니다. 난이도 시스템 도입, 트레이드 시스템 개편, 모바일 최적화 등 다양한 개선사항이 포함되어 있습니다.

---

## 🆕 주요 신규 기능

### 1. **게임 난이도 시스템 도입** ⭐ NEW!

게임을 시작할 때 난이도를 선택할 수 있는 시스템이 추가되었습니다.

#### **이지 모드 (Easy Mode) - 초보자 추천**
- 💰 **초기 자금**: 50억 원 (기존 20억 원에서 대폭 증가)
- 📊 **선수단 샐러리캡**: 200억 원 (기존 137억 원에서 증가)
- 🌍 **용병 샐러리캡**: 60억 원 (기존 40억 원에서 증가)
- 💵 **수입 보너스**: 모든 수입 1.2배 증가
- ⚖️ **샐러리캡 초과**: 가능 (초과분에 대해 2배 사치세 적용)
- 🤝 **AI 협상**: 관대함 (10~20% 할인 수락)
- 🔄 **트레이드**: 약간의 손해(10% 이내) 감수 가능
- 📈 **선수 성장**: 성장 확률 대폭 상승, 노화 시작 나이 2년 지연

#### **하드 모드 (Hard Mode) - 현실적 난이도 (권장)**
- 💰 **초기 자금**: 20억 원 (기존과 동일)
- 📊 **선수단 샐러리캡**: 137억 원 (KBO 규정 준수)
- 🌍 **용병 샐러리캡**: 40억 원 (기존과 동일)
- 💵 **수입 보너스**: 없음 (1.0배)
- ⚖️ **샐러리캡 초과**: 불가능 (하드 캡, 초과 시 진행 차단)
- 🤝 **AI 협상**: 깐깐함 (희망 연봉 100% 필수)
- 🔄 **트레이드**: 악덕 상인 모드 (이득만 수락)
- 📈 **선수 성장**: 현실적인 확률, 30세 이후 급격한 노화

**난이도 선택 화면**
- 게임 시작 시 난이도 선택 모달이 표시됩니다
- 각 모드의 특징과 설정값이 상세히 설명됩니다
- 헤더에 현재 난이도가 뱃지로 표시됩니다 (이지: 파란색, 하드: 빨간색)

---

### 2. **지시사항 모달 개선** ⭐ NEW!

게임 진행 중 사용할 수 있는 지시사항 모달이 대폭 개선되었습니다.

#### **"일정 진행" 버튼 고정 표시**
- 모달 맨 위에 항상 "일정 진행" 버튼이 고정 표시됩니다
- 금색 그라데이션 배경으로 다른 옵션과 시각적으로 구분됩니다
- 애니메이션 효과와 그림자로 강조됩니다

#### **스마트 옵션 필터링**
- 난이도 선택 옵션은 자동으로 필터링됩니다 (이미 선택 완료)
- 지시사항/가이드 옵션은 제거되었습니다
- 게임 상황에 맞는 옵션만 표시됩니다

---

## 🔧 주요 개선 사항

### 1. **트레이드 시스템 대폭 개편** 🔄

#### **이전 버전 (v1.0.0)**
- 모든 난이도에서 "악덕 상인" 모드
- 손해 보는 트레이드 무조건 거절
- 동등한 거래도 거절
- AI 구단이 반드시 이득을 봐야만 거래 성사

#### **현재 버전 (v2.0.0)**
- **난이도별 트레이드 로직**
  - **이지 모드**: AI가 관대함, 약간의 손해(10% 이내) 감수 가능
  - **하드 모드**: 기존 "악덕 상인" 모드 유지
  
- **상호 이익 거래 가능**
  - Win-Win 트레이드 수락 가능
  - 동등한 가치의 트레이드도 수락
  
- **역제안 시스템 추가**
  - "선수 OOO 대신 유망주 XXX를 주면 하겠다" 식의 역제안
  - 더 현실적인 협상 과정
  
- **팀 상황 반영**
  - **우승권 팀**: 즉시 전력감(A급 이상) 선호
  - **리빌딩 팀**: 유망주나 지명권 선호
  - **포지션 보강**: 취약 포지션 메우는 제안 긍정적 검토

**영향**: 이지 모드에서는 트레이드 성사 확률이 대폭 증가하여 게임 학습과 실험이 용이해졌습니다.

---

### 2. **외국인 선수 시스템 개선** 🌍

#### **한국인 제외 필터링 강화**
- 외국인 용병 리스트에서 한국인 선수 완전 제외
- 한국 국적 필터: 'Korea', '한국', 'South Korea', '대한민국' 제외
- 한국 이름 필터: 김, 이, 박, 최, 정 등 한국 성씨로 시작하는 이름 제외

#### **외국인 선수 이름 한국어 표시**
- 모든 외국인 선수 이름이 한글로 표기됩니다
- 예: "마이클 존슨", "카를로스 마르티네스", "사토 다케시"
- 영문 표기는 사용하지 않습니다

#### **데이터 표시 개선**
- **투수**: 평균 구속(km/h) 컬럼 추가 (140~165km/h 범위)
- **야수**: 포지션 컬럼을 맨 앞에 명확히 표시

---

### 3. **방송국 계약 시스템 개선** 📺

#### **3단계 필수 출력 프로세스**
1. **안내 텍스트**: "2026년 시즌을 위한 방송국 계약을 진행합니다..."
2. **방송국 목록**: 마크다운 테이블로 4개 방송국 정보 표시
3. **선택 옵션**: [OPTIONS] 태그로 4개 방송국 선택 버튼 제공

**개선 효과**: 1월 1주차에 방송국 계약이 누락되지 않고 정상적으로 표시됩니다.

---

### 4. **용병 영입 시스템 개선** ⚽

#### **영입 기회 보장 로직**
- **가격대별 비율 명시**
  - 고가형 (15억 이상): 20%
  - 중저가형 (7~14억): 50%
  - 저가형 (7억 미만): 30%
  
- **최소 3번의 협상 기회 보장**
  - 첫 제안이 마음에 들지 않아도 즉시 협상 결렬하지 않음
  - 역제안을 통해 협상 기회 제공

#### **AI 용병 영입 로직 개선**
- 샐러리캡 엄수 (3명 총액 40억/60억)
- 합리적 경쟁 (무조건적 입찰 금지)
- 성능 우선 영입

---

### 5. **모바일 반응형 UI/UX 전면 개선** 📱

#### **전체적인 개선**
- 터치 타겟 크기 최소 44px × 44px 보장
- 폰트 크기 모바일 최적화 (`text-sm` 권장)
- iOS 자동 줌 방지 (input 필드 `font-size: 16px`)
- 가로 스크롤 개선 (`overflow-x: auto`)

#### **컴포넌트별 개선**
- **팀 선택 화면**: 1열 레이아웃, 텍스트 크기 조정
- **데이터 테이블**: 가로 스크롤, `whitespace-nowrap` 적용
- **헤더**: `flex-wrap` 적용, 버튼 크기 조정
- **지시사항 모달**: 모바일 최적화 패딩 및 텍스트 크기
- **일정 진행 버튼**: 모바일에서도 명확히 보이도록 크기 조정

---

### 6. **저장/불러오기 시스템 강화** 💾

#### **난이도 정보 저장/복원**
- 게임 저장 시 난이도 정보 포함
- 불러오기 시 저장된 난이도 자동 복원
- 기존 저장 데이터 호환성 유지 (기본값: HARD)

#### **안정성 개선**
- 불러오기 시 API 연결 유지 (메시지 히스토리 복원)
- 중복 호출 방지 로직 추가
- 모바일 터치 이벤트 중복 방지

---

### 7. **코드 품질 및 성능 개선** ⚡

#### **치명적 버그 수정**
- ✅ `handleSend` 함수 TDZ(Temporal Dead Zone) 오류 해결
- ✅ 무한 렌더링 루프 수정 (`Maximum update depth exceeded`)
- ✅ `useSound` 훅 메모이제이션으로 안정성 향상

#### **최적화**
- 함수형 상태 업데이트 적용 (불필요한 리렌더링 방지)
- `useRef`를 활용한 안정적인 참조 관리
- 의존성 배열 최적화

---

## 🐛 버그 수정

### 1. **UI 버그 수정**
- ✅ "지시사항" 버튼이 불러오기 후 사라지는 문제 해결
- ✅ 모바일에서 텍스트 겹침 현상 개선
- ✅ 테이블 가로 스크롤 개선
- ✅ 방송국 계약 옵션이 표시되지 않는 문제 해결

### 2. **데이터 생성 버그 수정**
- ✅ 외국인 선수 리스트에 한국인 포함 문제 해결
- ✅ 외국인 투수 구속 데이터 누락 문제 해결
- ✅ 외국인 야수 포지션 표시 누락 문제 해결
- ✅ 외국인 선수 이름 영문 표기 문제 해결 (한글 표기로 변경)

### 3. **모바일 관련 버그 수정**
- ✅ 불러오기 시 무한 루프/재진행 오류 수정
- ✅ 터치 이벤트 중복 호출 방지
- ✅ 화면 레이아웃 깨짐 현상 개선

### 4. **렌더링 버그 수정**
- ✅ 무한 렌더링 루프 수정
- ✅ `useEffect` 의존성 배열 최적화
- ✅ 함수형 상태 업데이트로 중복 업데이트 방지

---

## 📊 변경 통계

### 수정된 파일
- `src/App.tsx` - 31줄 변경
- `src/components/ChatInterface.tsx` - 410줄 변경 (대규모 리팩토링)
- `src/components/GameHeader.tsx` - 87줄 변경
- `src/components/MessageBubble.tsx` - 10줄 변경
- `src/components/StartScreen.tsx` - 52줄 변경
- `src/components/TeamSelector.tsx` - 20줄 변경
- `src/components/OptionsModal.tsx` - 모바일 최적화 및 일정 진행 버튼 추가
- `src/constants/GameConstants.ts` - 440줄 변경 (프롬프트 대폭 개선)
- `src/index.css` - 27줄 변경
- `src/hooks/useSound.ts` - 메모이제이션 추가

### 신규 파일
- `src/components/DifficultyModal.tsx` - 난이도 선택 모달
- `src/constants/GameConfig.ts` - 난이도별 게임 설정

**총 변경량**: +654줄 추가, -427줄 삭제

---

## 🎮 게임플레이 변경사항

### **이지 모드 플레이어**
- ✅ 더 많은 자금으로 여유로운 운영 가능
- ✅ 트레이드 성사 확률 대폭 증가
- ✅ 선수 성장 확률 상승
- ✅ AI 협상이 더 관대함

### **하드 모드 플레이어**
- ⚠️ 기존과 동일한 도전적인 난이도
- ✅ 역제안 시스템으로 더 현실적인 협상
- ✅ 팀 상황 반영으로 전략적 트레이드 가능

---

## 📝 프롬프트 변경 사항

### **GameConstants.ts 대폭 개선 (440줄 변경)**

#### **난이도 시스템 프롬프트 추가**
- 이지/하드 모드별 자금, 샐러리캡, 수입 배율 명시
- 난이도별 AI 행동 패턴 가이드
- 저장/불러오기 시 난이도 정보 유지 규칙

#### **트레이드 시스템 프롬프트 개편**
- 난이도별 트레이드 로직
- 상호 이익 거래 가능
- 역제안 시스템
- 팀 상황 반영 (우승권/리빌딩)

#### **외국인 선수 생성 로직 강화**
- 한국인 제외 필터링 강화
- 외국인 선수 이름 한국어 표시 규칙
- 투수 구속 데이터 생성 규칙
- 야수 포지션 표시 규칙

#### **방송국 계약 로직 강화**
- 3단계 필수 출력 프로세스
- [OPTIONS] 태그 필수 포함 규칙

#### **용병 영입 시스템 개선**
- 가격대별 비율 명시
- 최소 3번의 협상 기회 보장
- AI 용병 영입 로직 개선

#### **기타 프롬프트 개선**
- 구단별 구단주 성향 고정 배분 추가
- 팀 케미스트리 및 사기 시스템 설명
- 연말 시상식 이벤트 규칙
- 날씨 및 우천 취소 변수
- 시스템 데이터 무결성 원칙 강화

---

## ⚠️ 주의사항

### **호환성**
- 기존 저장 파일은 자동으로 하드 모드로 인식됩니다
- 새로운 기능을 사용하려면 새 게임을 시작하는 것을 권장합니다

### **권장 사항**
- **초보자**: 이지 모드로 시작하여 게임 시스템을 익히세요
- **숙련자**: 하드 모드로 현실적인 도전을 즐기세요

---

## 🔮 향후 계획

이번 업데이트를 통해 게임의 밸런스와 사용자 경험이 크게 개선되었습니다. 다음 업데이트에서는 추가적인 게임플레이 개선과 새로운 기능이 추가될 예정입니다.

---

**패치 노트 작성일**: 2024년  
**버전**: v2.0.0  
**상태**: 로컬 개발 버전 (프로덕션 배포 전)

---

## 🙏 감사의 말

이번 업데이트에 많은 시간과 노력을 투입했습니다. 여러분의 피드백과 지원에 감사드리며, 더 나은 게임 경험을 제공하기 위해 계속 노력하겠습니다.

**즐거운 게임 되세요!** ⚾🎮

